<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏ÄÈîÆQA</title>
    <link rel="stylesheet" href="../common/layui/css/layui.css" />
    <link rel="stylesheet" href="../css/index.css">
    <script src="../common/layui/layui.js"></script>
    <script src="../common/components/ShowMessage.js" defer></script>
    <script src="../common/components/Loading.js" defer></script>
    <style>
        .alpineData {
            font-size: 14px;
            color: #333;
            display: flex;
            padding: 8px;
        }

        .leftAlpineBox {
            flex: 3;
            padding: 8px;
            border-radius: 6px;
        }

        .centerAlpineBox {
            padding: 8px;
            flex: 3;
            margin: 0 12px;
            border-radius: 6px;
        }

        .centerAlpineBox .layui-form-checkbox {
            margin-bottom: 4px;
        }

        .rightAlpineBox {
            padding: 8px;
            flex: 3;
            border-radius: 6px;
        }

        .data_textarea {
            resize: both;
            border: 1px solid #c2c2c2;
            border-radius: 4px;
        }

        .data_textarea::placeholder {
            color: #ccc;
        }

        .layui-btn {
            height: 36px;
            line-height: 36px;
            padding: 0 16px;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            transform: perspective(800px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .layui-btn-sm {
            margin: 6px 0;
            font-weight: 700;
            border-radius: 8px;
            background: linear-gradient(135deg, #1890ff 0%, #40a9ff 100%);
            border: none;
            box-shadow: 0 4px 15px rgba(24, 144, 255, 0.3);
        }

        .laybox {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>

<body>
    <div class="alpineData">
        <div class="leftAlpineBox layui-panel">
            <div class="tweHtml">
                <h4>ÂéüÂßãhtmlÔºö</h4>
                <hr>
                <textarea id="dataInput" class="data_textarea layui-textarea" placeholder="ËØ∑ËæìÂÖ•"></textarea>
                <div>
                    <iframe id="myIframe" src="" frameborder="0"
                        style="width: 100%;border: 1px solid #d8d8d8;margin-top: 10px;"></iframe>
                </div>
            </div>
        </div>
        <div class="centerAlpineBox layui-panel">
            <div class="layui-form laybox">
                <input type="checkbox" id="allSelectCheckbox" name="allSelect" title="ÂÖ®ÈÄâ" checked
                    lay-filter="checkbox-allSelect">
                <hr>
                <input type="checkbox" id="addMarginCheckbox" name="addMargin" title="hÊ†áÁ≠æpÊ†áÁ≠æÂä†margin" checked>
                <input type="checkbox" id="delUnderlineCheckbox" name="delUnderline" title="aÊ†áÁ≠æÂéªÊéâ‰∏ãÂàíÁ∫ø" checked>
                <input type="checkbox" id="replaceFontFamilyCheckbox" name="replaceFontFamily" title="ÊõøÊç¢ÊâÄÊúâfont-family"
                    checked>
                <input type="checkbox" id="tableFontFamilyCheckbox" name="tableFontFamily" title="Á¨¨‰∏Ä‰∏™tableÊ∑ªÂä†font-family"
                    checked>
                <input type="checkbox" id="replacePreNbspCheckbox" name="replacePreNbsp" title="ÊõøÊç¢preview-copy‰∏≠ÁöÑnbsp"
                    checked>
                <input type="checkbox" id="delNbspCheckbox" name="delNbsp" title="ÊõøÊç¢footerÁöÑÊúÄÂêé‰∏§‰∏™nbsp" checked>
                <input type="checkbox" id="del414MediaCheckbox" name="del414Media" title="ÂéªÈô§414Â™í‰ΩìÊü•ËØ¢" checked>
                <input type="checkbox" id="legalPackageCheckbox" name="legalPackage" title="ÂåÖË£πlegalÊú´Â∞æÈò≤Ê≠¢ÂçïÂ≠ó" checked>
                <input type="checkbox" id="replacepSelectorCheckbox" name="replacepSelector" title="ÊõøÊç¢css‰∏≠>pÈÄâÊã©Âô®"
                    checked>
                <input type="checkbox" id="imgToCenterCheckbox" name="imgToCenter" title="imgÂõæÁâáËÆæÁΩÆÂ±Ö‰∏≠" checked>
                <input type="checkbox" id="addDateZwnjCheckbox" name="addDateZwnj" title="Êó•ÊúüÈó¥Ê∑ªÂä†zwnj" checked>
                <input type="checkbox" id="appStoreNowrapCheckbox" name="addDateZwnj" title="footer‰∏ãËΩΩappStore‰∏çÊç¢Ë°å"
                    checked>
                <hr>
                <div>
                    <input type="checkbox" id="supNormalSizeCheckbox" name="supNormalSize"
                        title="sinaÈÇÆÁÆ±ÁßªÂä®Á´ØÊ∑ªÂä†supÊ†∑Âºè"><span class="layui-badge-rim layui-border-blue">sinaÈÇÆÁÆ±</span>
                </div>
                <div>
                    <input type="checkbox" id="setNowrapSpanCheckbox" name="setNowrapSpan"
                        title="mobileÁΩëÊòìspanËÆæÁΩÆnowrapÂ±ûÊÄß"><span class="layui-badge-rim layui-border-blue">163ÈÇÆÁÆ±</span>
                </div>
                <div>
                    <input type="checkbox" id="delUnderlineImportantCheckbox" name="delUnderlineImportant"
                        title="desktopÂéªÈô§‰∏ãÂàíÁ∫øÁöÑ!important"><span class="layui-badge-rim layui-border-blue">CN</span>
                </div>
                <hr>
            </div>
            <div class="layui-btn-container">
                <button id="submitButton"
                    class="layui-btn layui-btn-sm  layui-bg-blue layui-icon layui-icon-component">‰∏ÄÈîÆÊ∑ªÂä†QA</button>
                <button id="outputButton"
                    class="layui-btn layui-btn-sm  layui-bg-blue layui-icon layui-icon-fonts-code">ÁîüÊàêCode</button>
            </div>
        </div>
        <div class="rightAlpineBox layui-panel">
            <h4>QAÂêéhtmlÔºö</h4>
            <hr>
            <textarea id="dataOutput" class="data_textarea layui-textarea" placeholder="ÂæÖÁîüÊàê"></textarea>
            <hr>
            <div class="layui-btn-container">
                <button id="copyButton"
                    class="layui-btn layui-btn-sm  layui-bg-blue layui-icon layui-icon-file-b">Â§çÂà∂‰ª£Á†Å</button>
                <button id="resetButton"
                    class="layui-btn layui-btn-sm  layui-bg-blue layui-icon layui-icon-refresh">ÈáçÁΩÆÊâÄÊúâÊï∞ÊçÆ</button>
            </div>
        </div>
    </div>
    <script>
        // Êï∞ÊçÆÂ∫ì
        const langArr = [
            { lang: 'zh-HK', font: "font-family: system-ui, -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'SFNSText', 'PingFang HK', 'STHeiti', 'Helvetica Neue', Helvetica, 'ÂæÆËªüÊ≠£ÈªëÈ´îMicrosoft JhengHei', 'ÂæÆËªüÊ≠£ÈªëÈ´î Microsoft JhengHei', 'Microsoft JhengHei', 'ÂæÆËªüÊ≠£ÈªëÈ´î', 'MingLiU', Arial, sans-serif, 'SF Pro Icons'!important;" },
            { lang: 'zh-TW', font: "font-family: system-ui, -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'SFNSText', 'PingFang TC', 'STHeiti', 'Helvetica Neue', Helvetica, 'ÂæÆËªüÊ≠£ÈªëÈ´îMicrosoft JhengHei', 'ÂæÆËªüÊ≠£ÈªëÈ´î Microsoft JhengHei', 'Microsoft JhengHei', 'ÂæÆËªüÊ≠£ÈªëÈ´î', 'MingLiU', Arial, sans-serif, 'SF Pro Icons'!important;" },
            { lang: 'zh-CN', font: "font-family: system-ui, -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'SFNSText', 'PingFang SC', 'STHeiti', 'Helvetica Neue', Helvetica, 'Microsoft yahei', 'ÂæÆËΩØÈõÖÈªë', Arial, sans-serif, 'SF Pro Icons'!important;" },
            { lang: 'en-HK', font: "font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Helvetica, Arial, sans-serif, 'SF Pro Icons'!important;" },
        ]

        // #region
        const preCopyNbsp = `
        &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp;‚Äå‚Äå‚Äå&nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp; ‚†Ä &nbsp;‚Äå‚Äå‚Äå
        `
        // #endregion

        document.addEventListener('DOMContentLoaded', function () {
            const dataInput = document.getElementById('dataInput');
            const dataOutput = document.getElementById('dataOutput');
            const iframe = document.getElementById('myIframe');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

            // Checkbox element
            const allSelectCheckbox = document.getElementById('allSelectCheckbox');
            const addMarginCheckbox = document.getElementById('addMarginCheckbox');
            const delUnderlineCheckbox = document.getElementById('delUnderlineCheckbox');
            const replaceFontFamilyCheckbox = document.getElementById('replaceFontFamilyCheckbox');
            const tableFontFamilyCheckbox = document.getElementById('tableFontFamilyCheckbox');
            const replacePreNbspCheckbox = document.getElementById('replacePreNbspCheckbox');
            const delNbspCheckbox = document.getElementById('delNbspCheckbox');
            const del414MediaCheckbox = document.getElementById('del414MediaCheckbox');
            const legalPackageCheckbox = document.getElementById('legalPackageCheckbox');
            const replacepSelectorCheckbox = document.getElementById('replacepSelectorCheckbox');
            const imgToCenterCheckbox = document.getElementById('imgToCenterCheckbox');
            const addDateZwnjCheckbox = document.getElementById('addDateZwnjCheckbox');
            const appStoreNowrapCheckbox = document.getElementById('appStoreNowrapCheckbox');

            const supNormalSizeCheckbox = document.getElementById('supNormalSizeCheckbox');
            const setNowrapSpanCheckbox = document.getElementById('setNowrapSpanCheckbox');
            const delUnderlineImportantCheckbox = document.getElementById('delUnderlineImportantCheckbox');
            // Checkbox element

            const submitButton = document.getElementById('submitButton');
            const outputButton = document.getElementById('outputButton');
            const copyButton = document.getElementById('copyButton');
            const resetButton = document.getElementById('resetButton');

            let html_doc = '';
            let hiddenPreContent = '';
            let hiddenFontContent = '';
            const originalHexColorObj = {
                addMargin: [],
                delUnderline: [],
                delUnderlineImportant: [],
                appStoreNowrap: [],
            };
            let hexColorObj = originalHexColorObj
            const pre_placeholder = '<!-- [[PRE_PLACEHOLDER]] -->';
            const font_placeholder = '<!-- [[FONT_PLACEHOLDER]] -->';
            const zwnj_placeholder = '<!-- [[ZWNJ_PLACEHOLDER]] -->';

            // layuiÁöÑ‰∏Ä‰∫õÊñπÊ≥ï
            layui.use(function () {
                let form = layui.form;
                let layer = layui.layer;
                let util = layui.util;
                // ÂÖ®ÈÄâ
                form.on('checkbox(checkbox-allSelect)', function (data) {
                    const elem = data.elem; // Ëé∑Âæó checkbox ÂéüÂßã DOM ÂØπË±°
                    const checked = elem.checked; // Ëé∑Âæó checkbox ÈÄâ‰∏≠Áä∂ÊÄÅ
                    const value = elem.value; // Ëé∑Âæó checkbox ÂÄº
                    addMarginCheckbox.checked = elem.checked
                    delUnderlineCheckbox.checked = elem.checked
                    replaceFontFamilyCheckbox.checked = elem.checked
                    tableFontFamilyCheckbox.checked = elem.checked
                    replacePreNbspCheckbox.checked = elem.checked
                    delNbspCheckbox.checked = elem.checked
                    del414MediaCheckbox.checked = elem.checked
                    replacepSelectorCheckbox.checked = elem.checked
                    legalPackageCheckbox.checked = elem.checked
                    imgToCenterCheckbox.checked = elem.checked
                    addDateZwnjCheckbox.checked = elem.checked
                    appStoreNowrapCheckbox.checked = elem.checked
                });
            })

            // input‰∫ã‰ª∂
            dataInput.addEventListener('input', function () {
                html_doc = dataInput.value;
                toPlaceholder()
                handleOutput()
            });

            // Âç†‰ΩçÁ¨¶
            function toPlaceholder() {
                html_doc = html_doc.replace(/<div style="display: none; max-height: 0px; overflow: hidden;">([\s\S]*?)<\/div>/, (match, content) => {
                    console.log("üöÄ ~ html_doc=html_doc.replace ~ match:", match)
                    hiddenPreContent = match; // Â≠òÂÇ®ÂÜÖÂÆπ
                    return pre_placeholder; // ÊõøÊç¢‰∏∫Âç†‰ΩçÁ¨¶
                });
                html_doc = html_doc.replace(/\<!--\[if gte mso 9\]\>([\s\S]*)\<!\[endif\]--\>/, (match, content) => {
                    hiddenFontContent = match; // Â≠òÂÇ®ÂÜÖÂÆπ
                    return font_placeholder; // ÊõøÊç¢‰∏∫Âç†‰ΩçÁ¨¶
                });
                html_doc = html_doc.replace(/&zwnj;/g, zwnj_placeholder)
            }
            function delPlaceholder(iframehtml) {
                iframehtml = iframehtml.replace(pre_placeholder, hiddenPreContent);      // ÊõøÊç¢Âç†‰ΩçÁ¨¶‰∏∫ÂéüÂÜÖÂÆπ
                iframehtml = iframehtml.replace(font_placeholder, hiddenFontContent);

                console.log("üöÄ ~  ~ hexColorObj!!:", hexColorObj)

                const placeholders = {
                    'cornflowerblue': ['addMargin', 0],
                    'mediumspringgreen': ['delUnderline', 0],
                    'lightgoldenrodyellow': ['delUnderlineImportant', 0],
                    'blanchedalmond': ['appStoreNowrap', 0]
                };
                
                iframehtml = iframehtml.replace(/(cornflowerblue|mediumspringgreen|lightgoldenrodyellow|blanchedalmond)/g, 
                    (match) => {
                        const [prop, index] = placeholders[match];
                        placeholders[match][1]++; // Êõ¥Êñ∞Á¥¢ÂºïËÆ°Êï∞
                        return hexColorObj[prop][index];
                    }
                );
                iframehtml = iframehtml.replace(new RegExp(escapeRegExp(zwnj_placeholder), 'g'), '&zwnj;')
                return iframehtml
            }
            // Â∑•ÂÖ∑ÂáΩÊï∞-ËΩ¨‰πâÊ≠£Âàô‰∏≠ÁöÑÁâπÊÆäÂ≠óÁ¨¶
            function escapeRegExp(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // ËΩ¨‰πâÁâπÊÆäÂ≠óÁ¨¶
            }
            // Â∑•ÂÖ∑ÂáΩÊï∞-Â∞ÜRGBËΩ¨Êç¢‰∏∫ÂçÅÂÖ≠ËøõÂà∂
            function rgbToHex(rgb) {
                // ÊèêÂèñ RGB ÂÄº
                const result = rgb.match(/\d+/g);
                if (!result) return null;
                // ËΩ¨Êç¢‰∏∫ÂçÅÂÖ≠ËøõÂà∂
                return '#' + result.map(x => {
                    const hex = parseInt(x).toString(16).padStart(2, '0'); // ËΩ¨Êç¢‰∏∫ÂçÅÂÖ≠ËøõÂà∂Âπ∂Ë°•Èõ∂
                    return hex;
                }).join('');
            }

            // ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            submitButton.onclick = async () => {
                // localStorage.setItem('cy_outputButton_current_html', '')
                LoadingModule.show()
                html_doc = dataInput.value;
                toPlaceholder()
                handleOutput()
                const html_doc_promise = await new Promise((resolve) => {
                    setTimeout(() => {
                        console.log('iframeÂä†ËΩΩÂÆåÊàê');
                        if (addMarginCheckbox.checked) {
                            addMargin();
                        }
                        if (delUnderlineCheckbox.checked) {
                            delUnderline();
                        }
                        if (replaceFontFamilyCheckbox.checked) {
                            replaceFontFamily();
                        }
                        if (tableFontFamilyCheckbox.checked) {
                            tableFontFamily();
                        }
                        if (replacePreNbspCheckbox.checked) {
                            replacePreNbsp();
                        }
                        if (delNbspCheckbox.checked) {
                            delNbsp();
                        }
                        if (del414MediaCheckbox.checked) {
                            del414Media();
                        }
                        if (legalPackageCheckbox.checked) {
                            legalPackage();
                        }
                        if (replacepSelectorCheckbox.checked) {
                            replacepSelector();
                        }
                        if (imgToCenterCheckbox.checked) {
                            imgToCenter();
                        }
                        if (addDateZwnjCheckbox.checked) {
                            addDateZwnj();
                        }
                        if (appStoreNowrapCheckbox.checked) {
                            appStoreNowrap();
                        }

                        if (supNormalSizeCheckbox.checked) {
                            supNormalSize();
                        }
                        if (setNowrapSpanCheckbox.checked) {
                            setNowrapSpan();
                        }
                        if (delUnderlineImportantCheckbox.checked) {
                            delUnderlineImportant();
                        }
                        showMessage({ msg: 'QAÊ∑ªÂä†ÂÆåÊàêÔºÅ', type: 'success' })
                        LoadingModule.hide()
                        resolve(html_doc)
                    }, 0)
                })
                html_doc = html_doc_promise
            }
            outputButton.onclick = () => {
                // ÂéªÈô§tbody
                const tbodies = iframeDoc.querySelectorAll('tbody');
                tbodies.forEach(tbody => {
                    while (tbody.firstChild) {
                        tbody.parentNode.insertBefore(tbody.firstChild, tbody);
                    }
                    tbody.parentNode.removeChild(tbody);
                });
                // ÂéªÈô§Âç†‰ΩçÁ¨¶
                let iframeOutHtml = iframeDoc.documentElement.outerHTML
                iframeOutHtml = delPlaceholder(iframeOutHtml)
                dataOutput.value = '<!DOCTYPE html>' + iframeOutHtml;
                console.log("üöÄ ~ ËæìÂá∫ÁöÑ ~ iframeDoc:", iframeDoc.documentElement);

                // Â≠òÂÇ®Âà∞‰ºöËØùÂ≠òÂÇ®
                const compareObj = {
                    oldHtml: dataInput.value,
                    newHtml: dataOutput.value
                }
                localStorage.setItem('cy_outputButton_current_html', JSON.stringify(compareObj))
                showMessage({ msg: 'Â∑≤ÁîüÊàêÔºÅ', type: 'success' })
            }
            copyButton.onclick = async () => {
                try {
                    await navigator.clipboard.writeText(dataOutput.value);
                    showMessage({ msg: 'Â§çÂà∂ÊàêÂäüÔºÅ', type: 'success' })
                } catch (err) {
                    console.error(err);
                }
            }
            resetButton.onclick = () => {
                localStorage.setItem('cy_outputButton_current_html', '')
                hiddenPreContent = '';
                hiddenFontContent = '';
                hexColorObj = originalHexColorObj;
                dataInput.value = dataOutput.value = ''
                html_doc = ''
                handleOutput()
                const rightAlpineBox = document.querySelector('.rightAlpineBox')
                let checkboxes = rightAlpineBox.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
            }

            // function
            function handleOutput() {
                iframeDoc.open();
                iframeDoc.write(html_doc);
                iframeDoc.close();
            }
            // Áªôh1~h6,pÊ†áÁ≠æÂä†‰∏ämarginÔºö0Ôºõ
            function addMargin() {
                const elements = iframeDoc.querySelectorAll('h1, h2, h3, h4, h5, h6, p');
                console.log("üöÄ ~ addMargin ~ elements:", elements)
                elements.forEach(dom => {
                    if (!dom.style.margin && !dom.style.marginTop && !dom.style.marginRight && !dom.style.marginBottom && !dom.style.marginLeft) {
                        console.log('Âä† margin');
                        dom.style.margin = '0';
                        if (dom.style.color) {
                            const hexColor = rgbToHex(dom.style.color)
                            dom.style.color = 'cornflowerblue'
                            hexColorObj.addMargin.push(hexColor)
                        }
                    }
                });
            }
            // Âà†Èô§aÊ†áÁ≠æ‰∏ãÂàíÁ∫ø
            function delUnderline() {
                const elements = iframeDoc.querySelectorAll('a');
                console.log("üöÄ ~ delUnderline ~ elements:", elements)
                elements.forEach(a => {
                    if (!a.style.textDecoration) {
                        const computedTextDecoration = window.getComputedStyle(a).textDecorationLine
                        console.log('aÊ†áÁ≠æËÆ°ÁÆóÊ†∑Âºè', computedTextDecoration, 'aÊ†áÁ≠æË°åÂÜÖÊ†∑Âºè', a.style.textDecoration);
                        a.style.textDecoration = computedTextDecoration
                        if (a.style.color) {
                            const hexColor = rgbToHex(a.style.color)
                            a.style.color = 'mediumspringgreen'
                            hexColorObj.delUnderline.push(hexColor)
                        }
                    }
                });
            }
            // ÊõøÊç¢ÊâÄÊúâfont-family
            function replaceFontFamily() {
                let newFontFamily
                const curlang = iframeDoc.documentElement.lang;
                console.log("üöÄ ~ replaceFontFamily ~ curlang:", curlang)
                langArr.forEach(o => {
                    if (o.lang == curlang) {
                        newFontFamily = o.font
                    }
                })
                let htmlContent = iframeDoc.documentElement.outerHTML
                const regex = /font-family:\s*[^;]+;/g;
                htmlContent = htmlContent.replace(regex, newFontFamily)
                html_doc = htmlContent
                handleOutput()
            }
            // Á¨¨‰∏Ä‰∏™TableÊ∑ªÂä†font-family
            function tableFontFamily() {
                let newFontFamily
                const curlang = iframeDoc.documentElement.lang;
                langArr.forEach(o => {
                    if (o.lang == curlang) {
                        newFontFamily = o.font
                    }
                })
                const elements = iframeDoc.querySelector('table');
                let htmlContent = iframeDoc.documentElement.outerHTML
                if (elements && !elements.style.fontFamily) {
                    console.log('ÊõøÊç¢Á¨¨‰∏Ä‰∏™fontfamily');
                    htmlContent = htmlContent.replace(/\<table/, `<table style="${newFontFamily}"`)
                    html_doc = htmlContent
                }
                handleOutput()
            }
            // ÊõøÊç¢preview-copy‰∏≠ÁöÑnbsp
            function replacePreNbsp() {
                let htmlContent = iframeDoc.documentElement.outerHTML
                const preCopyString = htmlContent.replace(/<div style="display: none; max-height: 0px; overflow: hidden;">([\s\S]*?)<\/div>/, (match, content) => {
                    match = match.replace(content, preCopyNbsp)
                    return match; // ÊõøÊç¢‰∏∫Âç†‰ΩçÁ¨¶
                });
                html_doc = preCopyString
                handleOutput()
            }
            // Âà†Èô§Êú´Â∞æfooterÈÉ®ÂàÜnbsp
            function delNbsp() {
                let htmlContent = iframeDoc.documentElement.outerHTML
                const pattern = /(&nbsp;&nbsp;&nbsp;&nbsp;\|&nbsp;&nbsp;&nbsp;&nbsp;)/g;
                let matches = htmlContent.match(pattern);
                console.log("üöÄ ~ delNbsp ~ matches:", matches)
                if (matches.length == 4) {
                    let count = 0; // Áî®‰∫éËÆ°Êï∞ÊõøÊç¢Ê¨°Êï∞
                    const modifiedString = htmlContent.replace(pattern, (match) => {
                        count++;
                        return (count > 2) ? '&nbsp;&nbsp;&nbsp;&nbsp;\|&nbsp;&nbsp;&nbsp; ' : match;
                    });
                    html_doc = modifiedString
                    handleOutput()
                }
            }
            // Âà†Èô§414Â™í‰ΩìÊü•ËØ¢
            function del414Media() {
                let htmlContent = iframeDoc.documentElement.outerHTML
                let regex = /@media\s*screen\s*and\s*\(\s*max-device-width\s*:\s*414px\s*\)\s*{\s*u\s*~\s*div\s*{\s*min-width:\s*375px\s*;\s*}\s*body\s*,\s*u\s*\+\s*div\s*{\s*min-width\s*:\s*375px\s*;\s*}\s*}/;
                let replacement = `@media screen and (max-device-width:414px) {
          u ~ div { min-width: 100%;}
          body,u+div { min-width: 100%;}
        }`;
                html_doc = htmlContent.replace(regex, replacement);
                console.log("üöÄ ~ ÊõøÊç¢414")
                handleOutput()
            }
            // legalÊú´Â∞æÈò≤Ê≠¢ÂçïÂ≠ó
            function legalPackage() {
                // Ëé∑ÂèñsfcopyÊâÄÊúâÁöÑ p Ê†áÁ≠æ
                const sfcopy = iframeDoc.querySelectorAll('.sfcopy');
                const paragraphs = sfcopy[0] ? sfcopy[0].querySelectorAll('p') : [];
                console.log("üöÄ ~ legalPackage ~ paragraphs:", paragraphs)
                paragraphs.forEach(p => {
                    // Ëé∑Âèñ p Ê†áÁ≠æÁöÑÂÜÖÂÆπ
                    const text = p.innerHTML;
                    // Ê£ÄÊü•ÊúÄÂêé‰∏â‰∏™Â≠óÁ¨¶
                    if (text.length >= 3) {
                        const lastThreeChars = text.slice(-3);
                        const regex = /^[\u4e00-\u9fa5]{2}\„ÄÇ$/; // ÂåπÈÖç‰∏§‰∏™‰∏≠ÊñáÂ≠óÁ¨¶Âä†‰∏Ä‰∏™Âè•Âè∑
                        // Â¶ÇÊûúÂåπÈÖçÔºåËøõË°åÊõøÊç¢
                        if (regex.test(lastThreeChars)) {
                            // Áî® <span> ÂåÖË£πÊúÄÂêé‰∏â‰∏™Â≠óÁ¨¶
                            const wrappedText = text.slice(0, -3) + '<span class="nowrap" style="white-space: nowrap !important;">' + lastThreeChars + '</span>';
                            p.innerHTML = wrappedText;
                        }
                    }
                });
            }
            // ÊõøÊç¢css‰∏≠>pÈÄâÊã©Âô®
            function replacepSelector() {
                let htmlContent = iframeDoc.documentElement.outerHTML
                const regex = /\.m-.+?(>)p/g;
                html_doc = htmlContent.replace(regex, (match, content) => {
                    return match.replace(content, ' ');
                });
                console.log("üöÄ ~ ÊõøÊç¢>pÈÄâÊã©Âô®")
                handleOutput()
            }
            // imgÂõæÁâáËÆæÁΩÆÂ±Ö‰∏≠
            function imgToCenter() {
                const imgElement = iframeDoc.querySelectorAll('img');
                imgElement.forEach(o => {
                    const computedImgDisplay = window.getComputedStyle(o).display
                    const computedImgMarginLeft = window.getComputedStyle(o).marginLeft
                    const computedImgMarginRight = window.getComputedStyle(o).marginRight
                    const computedImgTextAlign = window.getComputedStyle(o).textAlign
                    console.log("üöÄ ~ imgToCenter ~ ÂõæÁâádisplay:", computedImgDisplay)
                    if (computedImgDisplay == 'block' && computedImgMarginLeft != '0px' && computedImgMarginLeft != '0' && computedImgMarginRight != '0px' && computedImgMarginRight != '0') {
                        o.style.display = 'inline-block'
                        o.style.textAlign = 'center'
                        o.style.verticalAlign = 'middle'
                    } else if (computedImgDisplay == 'inline-block' && computedImgTextAlign == 'center') {
                        o.style.display = 'inline-block'
                        o.style.textAlign = 'center'
                        o.style.verticalAlign = 'middle'
                    }
                })
            }
            // Êó•ÊúüÈó¥Ê∑ªÂä†zwnj
            function addDateZwnj() {

                let htmlContent = iframeDoc.documentElement.outerHTML
                // Ê∑ªÂä†Ê≠£ÂàôÂåπÈÖçÂíåÊõøÊç¢ÈÄªËæë
                const datePatterns = [
                    /(\d{4})\sÂπ¥\s(\d{1,2})\sÊúà\s(\d{1,2})\sÊó•/g,
                    /(\d{4})\sÂπ¥\s(\d{1,2})\sÊúà/g,
                    /(\d{1,2})\sÊúà\s(\d{1,2})\sÊó•/g,
                    /(\d{4})\sÂπ¥/g,
                    /(\d{1,2})\sÊúà/g,
                ];

                datePatterns.forEach(pattern => {
                    htmlContent = htmlContent.replace(pattern, (match) => {
                        // Â∞ÜÊó•Êúü‰∏≠ÁöÑÊØè‰∏™Â≠óÁ¨¶Áî® &zwnj; ËøûÊé•
                        console.log(match, 'hh');

                        return match.split('').join('&zwnj;');
                    });
                });
                html_doc = htmlContent;
                handleOutput();
            }
            // footer‰∏ãËΩΩappStore‰∏çÊç¢Ë°å
            function appStoreNowrap() {
                //Êü•ÊâæaÊ†áÁ≠æÔºåÂ¶ÇÊûúhref="${clicks.get('BNAV_APP')}"ÔºåÂàôËÆæÁΩÆwhite-space:nowrap
                const a = iframeDoc.querySelectorAll('a');

                a.forEach(o => {

                    if (o.href.includes("clicks.get('BNAV_APP')")) {
                        o.style.setProperty('white-space', 'nowrap');
                        if (o.style.color) {
                            const hexColor = rgbToHex(o.style.color)
                            console.log("üöÄ ~ appStoreNowrap ~ hexColor:", hexColor)
                            o.style.color = 'blanchedalmond'
                            hexColorObj.appStoreNowrap.push(hexColor)
                        }
                    }
                })
            }

            // mobileÁöÑsupÊ†áÁ≠æËÆæÁΩÆË°åÂÜÖÊ†∑ÂºèÔºàsinaÈÇÆÁÆ±Ôºâ
            function supNormalSize() {
                const desktopContainer = iframeDoc.querySelectorAll('.desktop-container');
                const sups = desktopContainer[0].querySelectorAll('sup');
                sups.forEach(o => {
                    o.style.fontSize = '0.65em'
                    o.style.lineHeight = '0'
                    o.style.verticalAlign = 'super'
                })
            }
            // mobileÁöÑspanÊ†áÁ≠æÂ¶ÇÊûúËÆæÁΩÆ‰∫Üwhite-space:nowrap,ËÆæÁΩÆclassÁ±ªÂêçnowrapÔºåÂπ∂‰∏înowrapÂä†importantÔºà163ÈÇÆÁÆ±Ôºâ
            function setNowrapSpan() {

                const mobileContainer = iframeDoc.querySelectorAll('.mobile-container');
                const sfcopy = iframeDoc.querySelectorAll('.sfcopy span');
                const spans = mobileContainer[0].querySelectorAll('span');
                [...spans, ...sfcopy].forEach(o => {
                    if (o.style.whiteSpace == 'nowrap') {
                        o.style.setProperty('white-space', 'nowrap', 'important')
                        o.classList.add('nowrap')
                    }
                })

                let htmlContent = iframeDoc.documentElement.outerHTML
                // Ê∑ªÂä†Ê≠£ÂàôÂåπÈÖçÂíåÊõøÊç¢ÈÄªËæë
                const regex = /\.eyebrow-text\s*,\s*\.nowrap\s*\{\s*white-space\s*:\s*nowrap\s*;\s*\}/g;
                html_doc = htmlContent.replace(regex, '.eyebrow-text, .nowrap { white-space: nowrap !important; }');
                handleOutput();
            }

            // desktopÂéªÈô§‰∏ãÂàíÁ∫øÁöÑ!important
            function delUnderlineImportant() {

                const desktopContainer = iframeDoc.querySelectorAll('.desktop-container');
                const a_href = desktopContainer[0].querySelectorAll('a');
                a_href.forEach(a => {
                    if (!a.className.includes('btn')) {
                        a.style.textDecoration = 'none';
                        if (a.style.color) {
                            const hexColor = rgbToHex(a.style.color)
                            a.style.color = 'lightgoldenrodyellow'
                            hexColorObj.delUnderlineImportant.push(hexColor)
                        }
                    }
                });
            }

        });
    </script>
</body>

</html>