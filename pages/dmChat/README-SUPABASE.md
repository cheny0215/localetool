# Supabase èŠå¤©å®¤ä½¿ç”¨è¯´æ˜

## ğŸ“‹ åŠŸèƒ½ç‰¹ç‚¹

- âœ… å®æ—¶æ¶ˆæ¯åŒæ­¥ï¼ˆä½¿ç”¨ Supabase Realtimeï¼‰
- âœ… åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡ï¼ˆä½¿ç”¨ Presenceï¼‰
- âœ… ç®€å•çš„ç”¨æˆ·è®¤è¯ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰
- âœ… æ¶ˆæ¯å†å²è®°å½•
- âœ… ç³»ç»Ÿæ¶ˆæ¯æç¤º
- âœ… å“åº”å¼è®¾è®¡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»º Supabase é¡¹ç›®

1. è®¿é—® [Supabase](https://supabase.com)
2. æ³¨å†Œ/ç™»å½•è´¦å·
3. åˆ›å»ºæ–°é¡¹ç›®
4. ç­‰å¾…é¡¹ç›®åˆå§‹åŒ–å®Œæˆ

### 2. è®¾ç½®æ•°æ®åº“

1. åœ¨ Supabase Dashboard ä¸­ï¼Œè¿›å…¥ **SQL Editor**
2. å¤åˆ¶ `supabase-setup.sql` æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹
3. ç²˜è´´å¹¶æ‰§è¡Œ SQL ä»£ç 
4. ç¡®è®¤ `messages` è¡¨å·²åˆ›å»ºæˆåŠŸ

### 3. å¯ç”¨å®æ—¶è®¢é˜…

**é‡è¦ï¼šè¿™ä¸€æ­¥æ˜¯è®©æ¶ˆæ¯å®æ—¶åŒæ­¥çš„å…³é”®ï¼**

#### æ–¹æ³•ä¸€ï¼šé€šè¿‡ SQL å¯ç”¨ï¼ˆæ¨èï¼Œå·²åŒ…å«åœ¨ SQL è„šæœ¬ä¸­ï¼‰

å¦‚æœä½ å·²ç»æ‰§è¡Œäº† `supabase-setup.sql` ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œå®æ—¶è®¢é˜…åº”è¯¥å·²ç»è‡ªåŠ¨å¯ç”¨äº†ã€‚è¿™è¡Œä»£ç ä¼šå¤„ç†ï¼š

```sql
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
```

#### æ–¹æ³•äºŒï¼šé€šè¿‡ç•Œé¢æ‰‹åŠ¨å¯ç”¨

å¦‚æœæ–¹æ³•ä¸€æ²¡æœ‰ç”Ÿæ•ˆï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼š

1. ç™»å½• Supabase Dashboard
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. ç‚¹å‡»å·¦ä¾§èœå•çš„ **Database**
4. ç‚¹å‡» **Replication** æ ‡ç­¾ï¼ˆåœ¨ Tablesã€Functions ç­‰æ—è¾¹ï¼‰
5. åœ¨ **Source** ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹© `0 tables`ï¼ˆå¦‚æœæ˜¾ç¤ºæ•°å­—ï¼‰
6. æ‰¾åˆ° `messages` è¡¨
7. ç‚¹å‡»è¡¨åå³ä¾§çš„å¼€å…³ï¼Œç¡®ä¿å®ƒæ˜¯**ç»¿è‰²/å¼€å¯**çŠ¶æ€
8. å¦‚æœçœ‹åˆ° "Enable Replication" æŒ‰é’®ï¼Œç‚¹å‡»å®ƒ

#### éªŒè¯æ˜¯å¦å¯ç”¨æˆåŠŸ

åœ¨ SQL Editor ä¸­è¿è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼š

```sql
SELECT schemaname, tablename 
FROM pg_publication_tables 
WHERE pubname = 'supabase_realtime';
```

å¦‚æœç»“æœä¸­åŒ…å« `messages` è¡¨ï¼Œè¯´æ˜å¯ç”¨æˆåŠŸï¼

### 4. è·å–é¡¹ç›®é…ç½®

1. è¿›å…¥ **Settings** > **API**
2. å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Project URL** (ä¾‹å¦‚: `https://xxxxx.supabase.co`)
   - **anon public** key

### 5. é…ç½®é¡¹ç›®ï¼ˆå®‰å…¨æ–¹å¼ï¼‰

âš ï¸ **é‡è¦ï¼šä¸è¦ç›´æ¥åœ¨ä»£ç ä¸­å†™é…ç½®ï¼**

#### æ¨èæ–¹å¼ 1ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶

1. å¤åˆ¶é…ç½®ç¤ºä¾‹ï¼š
   ```bash
   cp config.example.js config.js
   ```

2. ç¼–è¾‘ `config.js`ï¼Œå¡«å…¥ä½ çš„é…ç½®ï¼š
   ```javascript
   const SUPABASE_CONFIG = {
       url: 'https://xxxxx.supabase.co',
       anonKey: 'eyJhbGci...'
   };
   ```

3. ç¡®ä¿ `config.js` åœ¨ `.gitignore` ä¸­ï¼ˆå·²åŒ…å«ï¼‰

4. ä½¿ç”¨ `secure-chat.html` æ–‡ä»¶

#### æ¨èæ–¹å¼ 2ï¼šé¦–æ¬¡è®¿é—®æ—¶é…ç½®

1. ç›´æ¥æ‰“å¼€ `secure-chat.html`
2. é¦–æ¬¡è®¿é—®ä¼šæç¤ºè¾“å…¥é…ç½®
3. é…ç½®ä¼šå®‰å…¨ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°

è¯¦ç»†å®‰å…¨é…ç½®è¯´æ˜è¯·æŸ¥çœ‹ [SECURITY-GUIDE.md](./SECURITY-GUIDE.md)

### 6. è¿è¡Œé¡¹ç›®

ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `secure-chat.html` æ–‡ä»¶å³å¯ä½¿ç”¨ï¼

**æ–‡ä»¶è¯´æ˜ï¼š**
- `secure-chat.html` - å®‰å…¨ç‰ˆæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰
- `chat.html` - å¸¦è°ƒè¯•åŠŸèƒ½çš„ç‰ˆæœ¬
- `test-realtime.html` - è¯Šæ–­å·¥å…·

## ğŸ“Š æ•°æ®åº“ç»“æ„

### messages è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | BIGSERIAL | ä¸»é”®ï¼Œè‡ªå¢ |
| user_id | TEXT | ç”¨æˆ·ID |
| username | TEXT | ç”¨æˆ·æ˜µç§° |
| content | TEXT | æ¶ˆæ¯å†…å®¹ |
| type | TEXT | æ¶ˆæ¯ç±»å‹ï¼ˆchat/systemï¼‰ |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |

## ğŸ”§ æŠ€æœ¯æ ˆ

- **å‰ç«¯**: çº¯ HTML + CSS + JavaScript
- **åç«¯**: Supabase (PostgreSQL + Realtime)
- **å®æ—¶é€šä¿¡**: Supabase Realtime (æ›¿ä»£ WebSocket)
- **åœ¨çº¿çŠ¶æ€**: Supabase Presence

## ğŸ†š ä¸åŸç‰ˆæœ¬çš„åŒºåˆ«

### åŸç‰ˆæœ¬ï¼ˆNode.js + WebSocketï¼‰
- éœ€è¦éƒ¨ç½² Node.js æœåŠ¡å™¨
- éœ€è¦é…ç½® HTTPS è¯ä¹¦
- éœ€è¦ç®¡ç† WebSocket è¿æ¥
- éœ€è¦è‡ªå·±å®ç°ç”¨æˆ·è®¤è¯
- éœ€è¦è‡ªå·±ç®¡ç†æ•°æ®åº“

### Supabase ç‰ˆæœ¬
- âœ… æ— éœ€æœåŠ¡å™¨éƒ¨ç½²
- âœ… è‡ªåŠ¨ HTTPS
- âœ… è‡ªåŠ¨å¤„ç†å®æ—¶è¿æ¥
- âœ… å†…ç½®è®¤è¯ç³»ç»Ÿï¼ˆå¯æ‰©å±•ï¼‰
- âœ… æ‰˜ç®¡æ•°æ®åº“
- âœ… å…è´¹é¢åº¦å……è¶³

## ğŸ¨ è‡ªå®šä¹‰

### ä¿®æ”¹ä¸»é¢˜é¢œè‰²

åœ¨ CSS ä¸­æ‰¾åˆ°ä»¥ä¸‹æ¸å˜è‰²å¹¶ä¿®æ”¹ï¼š

```css
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
```

### è°ƒæ•´æ¶ˆæ¯æ•°é‡é™åˆ¶

åœ¨ `loadMessages()` å‡½æ•°ä¸­ä¿®æ”¹ï¼š

```javascript
.limit(50);  // ä¿®æ”¹ä¸ºä½ æƒ³è¦çš„æ•°é‡
```

### æ·»åŠ æ›´å¤šåŠŸèƒ½

å¯ä»¥æ‰©å±•çš„åŠŸèƒ½ï¼š
- å›¾ç‰‡ä¸Šä¼ ï¼ˆä½¿ç”¨ Supabase Storageï¼‰
- è¡¨æƒ…ç¬¦å·
- @æåŠåŠŸèƒ½
- ç§èŠåŠŸèƒ½
- æ¶ˆæ¯ç¼–è¾‘/åˆ é™¤
- ç”¨æˆ·å¤´åƒï¼ˆä½¿ç”¨ Supabase Authï¼‰

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ¶ˆæ¯ä¸å®æ—¶æ›´æ–°ï¼Ÿ

**è§£å†³æ­¥éª¤ï¼š**

a) æ£€æŸ¥å®æ—¶è®¢é˜…æ˜¯å¦å¯ç”¨ï¼š
   - åœ¨ SQL Editor è¿è¡Œï¼š
     ```sql
     SELECT schemaname, tablename 
     FROM pg_publication_tables 
     WHERE pubname = 'supabase_realtime';
     ```
   - åº”è¯¥èƒ½çœ‹åˆ° `messages` è¡¨

b) å¦‚æœæ²¡æœ‰çœ‹åˆ°ï¼Œæ‰‹åŠ¨å¯ç”¨ï¼š
   ```sql
   ALTER PUBLICATION supabase_realtime ADD TABLE messages;
   ```

c) æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼š
   - æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
   - æŸ¥çœ‹ Console æ ‡ç­¾æ˜¯å¦æœ‰é”™è¯¯
   - åº”è¯¥èƒ½çœ‹åˆ° "SUBSCRIBED" çŠ¶æ€

d) ç¡®è®¤é…ç½®æ­£ç¡®ï¼š
   - æ£€æŸ¥ SUPABASE_URL å’Œ SUPABASE_ANON_KEY æ˜¯å¦æ­£ç¡®
   - URL æ ¼å¼åº”è¯¥æ˜¯ï¼š`https://xxxxx.supabase.co`

### 2. æ— æ³•å‘é€æ¶ˆæ¯ï¼Ÿ

- æ£€æŸ¥ RLS ç­–ç•¥æ˜¯å¦æ­£ç¡®è®¾ç½®
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

### 3. åœ¨çº¿äººæ•°ä¸å‡†ç¡®ï¼Ÿ

- Presence åŠŸèƒ½ä¾èµ–äºæ´»è·ƒè¿æ¥
- åˆ·æ–°é¡µé¢ä¼šé‡æ–°è®¡æ•°
- å…³é—­é¡µé¢åå¯èƒ½æœ‰çŸ­æš‚å»¶è¿Ÿ

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å…è´¹é¢åº¦**: Supabase å…è´¹ç‰ˆæœ‰ä¸€å®šé™åˆ¶ï¼Œé€‚åˆå°å‹é¡¹ç›®
2. **å®‰å…¨æ€§**: å½“å‰ç‰ˆæœ¬ä½¿ç”¨ç®€å•çš„æœ¬åœ°è®¤è¯ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Supabase Auth
3. **æ€§èƒ½**: æ¶ˆæ¯é‡å¤§æ—¶å»ºè®®å®ç°åˆ†é¡µåŠ è½½
4. **æ¸…ç†**: å®šæœŸæ¸…ç†æ—§æ¶ˆæ¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´

## ğŸ”— ç›¸å…³é“¾æ¥

- [Supabase å®˜æ–¹æ–‡æ¡£](https://supabase.com/docs)
- [Supabase Realtime æ–‡æ¡£](https://supabase.com/docs/guides/realtime)
- [Supabase Presence æ–‡æ¡£](https://supabase.com/docs/guides/realtime/presence)

## ğŸ“„ è®¸å¯

MIT License
