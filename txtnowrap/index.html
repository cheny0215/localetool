<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index.txtæ–‡æœ¬å»é™¤æ¢è¡Œç¬¦</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../common/layui/css/layui.css"/>
    <script src="../common/layui/layui.js"></script>
</head>

<body>
    <p style="font-size: 14px;color: #999;padding:10px 0;">è¯´æ˜ï¼šå°†å¯¼å‡ºçš„txtæ–‡æœ¬å†…å®¹ç²˜è´´åˆ°æ–‡æœ¬æ¡†ï¼Œç„¶åç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å°†è½¬æ¢å¥½çš„æ–‡æœ¬å†…å®¹ç²˜è´´å›txtå†…</p>
    <div id="nowrapTxt" contenteditable="true"
        style="width: 800px;height: 250px;overflow: auto;text-wrap: nowrap;border-radius: 4px;margin-bottom: 20px;border: 1px solid #d3d2d2;">
    </div>
    <button id="noWrapBtn" class="layui-btn layui-btn-sm layui-btn-primary layui-border">&gt;&gt;ç‚¹å‡»æ¸…é™¤æ¢è¡Œç¬¦&lt;&lt;</button>&nbsp;&nbsp;
    <button id="clearBtn" class="layui-btn layui-btn-sm layui-btn-primary layui-border">&gt;&gt;æ¸…ç©ºå†…å®¹&lt;&lt;</button>


    <script>

        const noWrapBtn = document.getElementById('noWrapBtn')
        const clearBtn = document.getElementById('clearBtn')
        const nowrapTxt = document.getElementById('nowrapTxt')

        noWrapBtn.addEventListener('click', function () {
            processText(nowrapTxt.innerText)
        })

        clearBtn.addEventListener('click', function () {
            nowrapTxt.innerText = ''
        })

        function processText(input) {
            // console.log("ğŸš€ ~ nowrapTxt:", input)
            // ç¬¬ä¸€æ­¥ï¼šç”¨ç‰¹æ®Šæ ‡è®°æ›¿æ¢æ‰€æœ‰ç©ºè¡Œ
            let textWithMarkers = input.replace(/\n\s*\n/g, '\n<<EMPTY_LINE>>\n');

            // ç¬¬äºŒæ­¥ï¼šåˆ é™¤æ‰€æœ‰æ¢è¡Œç¬¦
            let textWithoutNewlines = textWithMarkers.replace(/\n/g, '');

            // ç¬¬ä¸‰æ­¥ï¼šå°†ç‰¹æ®Šæ ‡è®°è½¬æ¢ä¸ºç©ºè¡Œ
            let finalText = textWithoutNewlines.replace(/<<EMPTY_LINE>>/g, '\n\n');

            // ç¬¬å››æ­¥ï¼šåœ¨æ‰€æœ‰ `${clicks.get` å‰æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦
            finalText = finalText.replace(/(\${clicks\.get[^\}]+\})/g, '\n$1');
            finalText = finalText.replace(/(\${global[^\}]+\})/g, '\n$1');

            // // ç¬¬äº”æ­¥ï¼šå¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿
            // navigator.clipboard.writeText(finalText.trim())
            //     .then(() => {
            //         console.log('æ–‡æœ¬å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿');
            //     })
            //     .catch(err => {
            //         console.error('å¤åˆ¶åˆ°å‰ªè´´æ¿å¤±è´¥: ', err);
            //     });


            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ–‡æœ¬åŒºåŸŸ
            const textArea = document.createElement('textarea');
            textArea.value = finalText.trim();

            // å°†æ–‡æœ¬åŒºåŸŸæ·»åŠ åˆ°æ–‡æ¡£ä¸­
            document.body.appendChild(textArea);

            // é€‰æ‹©æ–‡æœ¬åŒºåŸŸçš„å†…å®¹
            textArea.select();
            textArea.setSelectionRange(0, 99999); // å¯¹äºç§»åŠ¨è®¾å¤‡çš„å…¼å®¹

            // æ‰§è¡Œå¤åˆ¶å‘½ä»¤
            document.execCommand('copy');

            // ç§»é™¤ä¸´æ—¶æ–‡æœ¬åŒºåŸŸ
            document.body.removeChild(textArea);
            alert('æ–‡æœ¬å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿')

        }



    </script>
</body>

</html>